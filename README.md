# Music Service

В данном проекте реализована онлайн библиотека песен. 
Вся библиотека хранится на remoteServer. При добавлении песни, песня и вся информация о ней переносится в базу данных внутреннего сервера.

Для каждой песни хранятся следующие данные:
- Group - название исполнителя 
- Song - название песнм 
- Release Date - дата выхода песни 
- Text - текст песни 
- Link - ссылка на песню


## Makefile

В Makefile есть три цели:
- make all - запуск run_server1
- make run_server1 - запуск внутреннего сервера хранения данных (server) и его окружения (база PostgreSql)
- make run_server2 - запуск удаленного сервера хранения данных (remoteServer) и его окружения (база PostgreSql)
- make test - запусков тестов (выполняется после запуска серверов)

При необходимости можно запустить сервера вручную, последовательно введя команды Makefile


## Конфигурация серверов

Конфигурация серверов находится в файле ./env в корне проекта.

При запуске серверов, конфигурация автоматически считывается на сервер, поэтому их легко поменять при запуске.

В файле есть следующие параметры:
- INTERNAL_SERVER_ADDRESS - адрес на котором работает внутренний сервер
- REMOTE_SERVER_ADDRESS - адрес на котором работает удаленный сервер
- SERVER_DEBUG_MODE - режим DEBUG, позволяет видеть информацию для разработчика (true - включен, false - выключен) 
- POSTGRES_INTERNAL_SERVER_HOST - хост базы данных встроенного сервера
- POSTGRES_INTERNAL_SERVER_PORT - порт базы данных встроенного сервера
- POSTGRES_INTERNAL_SERVER_USERNAME - имя пользователя базы данных встроенного сервера
- POSTGRES_INTERNAL_SERVER_PASSWORD - пароль базы данных встроенного сервера
- POSTGRES_INTERNAL_SERVER_DB_NAME - имя базы данных встроенного сервера
- POSTGRES_REMOTE_SERVER_HOST - хост базы данных удаленного сервера
- POSTGRES_REMOTE_SERVER_PORT - порт базы данных удаленного сервера
- POSTGRES_REMOTE_SERVER_USERNAME - имя пользователя базы данных удаленного сервера
- POSTGRES_REMOTE_SERVER_PASSWORD - пароль базы данных удаленного сервера
- POSTGRES_REMOTE_SERVER_DB_NAME - имя базы данных удаленного сервера 

При запуске сервера и клиента, конфигурация автоматически считывается с файла, тем самым можно легко поменять стартовые параметры работы сервера.


## Remote server

Remote server предназначен для хранения песен и информции о них. Конфигурация находится в файле ./env в корне проекта. При изменении настроек сервера, настройки также необходимо поменять в файле ./remoteServer/docker-compose.yaml

Данные о песнях хранятся в релеционной базе данных PostgreSQL. 


#### API

Remote server реализован на REST API. 

Реализован метод получения информации о песнях Info, который на входе получает исполнителя и название песни.
Метод возвращает:
- StatusCode 200 и информацию о песне если запрос корректно отработал.
- StatusCode 400 если песня не найдена либо запрос некорректен.
- StatusCode 500 если произошла внутренняя ошибка на сервере

Остановить сервер можно сочетанием клавиш CRRL+C. После этого будет произведен Graceful Shutdown сервера c завершением всех запущенных goroutine, необходимых для более быстрой работы и решения проблемы конкурентных запросов.



## Server

Server предназначен для хранения добавленных с удаленного севера песен и информации о них. 
Конфигурация находится в файле ./env в корне проекта. При изменении настроек сервера, настройки также необходимо поменять в файле ./Server/docker-compose.yaml

Данные о песнях хранятся в релеционной базе данных PostgreSQL. 


#### API

Server реализован на REST API. 

Реализованы слудующие методы:

- Add - метод получения информации о песнях c удаленного сервера, который на входе получает исполнителя и название песни.
После получения запроса, сервер делает запрос на удаленный сервер и добавляет песню в базу данных, если запрос был корректен.
  Метод возвращает:
  - StatusCode 200 и информацию о результате выполнения.
  - StatusCode 400 и информацию об ошибке.
  - StatusCode 500 если произошла внутренняя ошибка на сервере

- Delete - метод удаления информации о песни c  встроенного сервера, который на входе получает исполнителя и название песни.
  Метод возвращает:
  - StatusCode 200 и информацию о результате выполнения.
  - StatusCode 400 и информацию об ошибке.
  - StatusCode 500 если произошла внутренняя ошибка на сервере

- Change - метод изменения информации о песни на встроенном сервера, который на входе получает исполнителя и название песни, а также данные, которые надо изменить. В случае если параметр пустой, значит поле остается неизменным
  Метод возвращает:
  - StatusCode 200 и информацию о результате выполнения.
  - StatusCode 400 и информацию об ошибке.
  - StatusCode 500 если произошла внутренняя ошибка на сервере

- GetSongText - метод получения текста песни со встроенного сервера, который на входе получает исполнителя и название песни
  Метод возвращает:
  - StatusCode 200 и текст песни с пагинацией по куплетам.
  - StatusCode 400 и информацию об ошибке.
  - StatusCode 500 если произошла внутренняя ошибка на сервере
  
- GetSongs - метод получения списка песен с пагинацией и полной информацией о песне со встроенного сервера, которые соотвествуют фильтру, переданному на входе метода. Фильтровать можно по любым данным песни (исполнитель, название, дата выхода, текст, ссылка)
  Метод возвращает:
  - StatusCode 200 и список песен с пагинацией
  - StatusCode 400 и информацию об ошибке.
  - StatusCode 500 если произошла внутренняя ошибка на сервере

Остановить сервер можно сочетанием клавиш CRRL+C. После этого будет произведен Graceful Shutdown сервера c завершением всех запущенных goroutine, необходимых для более быстрой работы и решения проблемы конкурентных запросов.


#### PostgreSQL

При запуске серверов, автоматически запускаются релеционные базы данных PostgreSQL в Docker. 
Dockerfile распологается в ./server/database/  и ./remoteServer/database/ 

Настройка запуска баз реализована в файлах docker-compose.yaml. 
Все параметры для реализации базы данных можно поменять в этом файле. При изменении параметров, необходимо аналогично поменять значения параметров в файле конфигурации подключения серверов к базам данных ./env, расположенного в корне проекта

В базах данных хранится информация о песнях



## Тестирование

В проекте реализовано автоматическое тестирование работы сервиса методом черной коробки.

Для запуска тестирования необходимо запустить оба сервера и выполнить make test.

Результат тестирования может отличаться, если ранее были изменены данные на встроенном сервере.
После тестирования можно ознакомиться с запущенными тестами, их результатом, ожидаемым результатом теста и полученным результатом. На серверах можно ознакомиться с логами в ходе выполенния запросов для тестирования